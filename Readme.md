# Just a prototype of showing case in Hong Kong map

# Setup environment

The development environment is Ubuntu server 20
 
## Install selenium, firefox and gecko driver on headless Linux

```bash
sudo apt update
sudo apt install firefox python3-pip
sudo -H pip3 install selenium

export GECKO_DRIVER_VERSION='v0.28.0'
wget https://github.com/mozilla/geckodriver/releases/download/$GECKO_DRIVER_VERSION/geckodriver-$GECKO_DRIVER_VERSION-linux64.tar.gz
tar -xvzf geckodriver-$GECKO_DRIVER_VERSION-linux64.tar.gz
rm geckodriver-$GECKO_DRIVER_VERSION-linux64.tar.gz
chmod +x geckodriver
sudo cp geckodriver /usr/local/bin/

sudo apt install pkg-config libcairo2-dev libgirepository1.0-dev gir1.2-gst-rtsp-server-1.0 gstreamer1.0-plugins-ugly ffmpeg
```

Reference: https://gist.github.com/pcgeek86/a1fd9d26f8ad46b51adf9513f67b95f2

## Install NPM 

```bash
sudo apt install npm
npm install
npm run serve
```

## Create a virtual environment 

This program require Python 3.6 to work

Please use the following command to setup environment
```
conda env list
conda create --name hkcovidenv python=3.6
conda activate hkcovidenv

conda env remove --name hkcovidenv
```

## Install python package

If you want to use the jupyter notebook file, please install jupyter.
```bash
pip3 install --upgrade pip
pip3 install jupyter
```

Install reset of the dependencies using this command

```bash
pip3 install -r requirements.txt
```

## Install Noto CJK fonts

```bash
pip3 install -r requirements.txt
wget -c https://noto-website.storage.googleapis.com/pkgs/Noto-hinted.zip
unzip Noto-hinted.zip -d Noto
sudo cp Noto /usr/local/share/fonts/ -a
sudo chown root /usr/local/share/fonts/Noto -R
sudo chmod 644 /usr/local/share/fonts/Noto/* -R
sudo chmod 755 /usr/local/share/fonts/Noto
sudo fc-cache -fv
# verify here
fc-match -a | grep Noto

# clear matplotlib font cache
rm ~/.cache/matplotlib -rf
```

# How to use

* batch.py create the image and data for display. The output is ./out/batch-date
* ./slide is a vue program which loop through the image and data under ./slide/info. These data are generated by batch.py

# Additional info

## 18 district info
https://gis.stackexchange.com/questions/183248/getting-polygon-boundaries-of-city-in-json-from-google-maps-api

Search for the OSM id
https://nominatim.openstreetmap.org/ui/details.html?osmtype=R&osmid=2800276&class=boundary

Paste the OSM id to this website
http://polygons.openstreetmap.fr/index.py


# Youtube broadcast

* Main map
	animated for 7 days 
* district map
	animated for 7 days 

# Architecture setup

1. Install all the program 

2. Setup cron job to run the batch job periodically

3. Run the slide program, and a website is hosted on localhost:8080

4. Run the streamTest2.py to capture screenshot from slide app and create a RTSP stream

5. Redirect the stream to youtube

	ffmpeg -f lavfi -i anullsrc -rtsp_transport udp -i rtsp://localhost:8554/test -tune zerolatency -vcodec libx264 -t 12:00:00 -pix_fmt + -c:v copy -c:a aac -strict experimental -f flv rtmp://a.rtmp.youtube.com/live2/xxxx-xxxx-xxxx-xxxx-xxxx < /dev/null > /dev/null 2>&1 &



# Reference

https://blog.yeshuanova.com/2017/10/python-visulization-folium/

https://medium.com/coinmonks/visualizing-property-prices-in-hong-kong-with-pandas-overpy-and-folium-595240ffca90

https://flourish.studio/


/home/ymlai/.local/share/pyppeteer/local-chromium/588429/chrome-linux/chrome --disable-background-networking --disable-background-timer-throttling --disable-breakpad --disable-browser-side-navigation --disable-client-side-phishing-detection --disable-default-apps --disable-dev-shm-usage --disable-extensions --disable-features=site-per-process --disable-hang-monitor --disable-popup-blocking --disable-prompt-on-repost --disable-sync --disable-translate --metrics-recording-only --no-first-run --safebrowsing-disable-auto-update --enable-automation --password-store=basic --use-mock-keychain --headless --hide-scrollbars --mute-audio about:blank --remote-debugging-port=46381 --user-data-dir=/home/ymlai/.local/share/pyppeteer/.dev_profile/tmp48so0i2y